<!DOCTYPE html>
<html>
    <head>
        <meta charset=UTF-8 />
        <style>
            html, body {
                background-color: #000;
                margin: 0;
                padding: 0;
                height: 100%;
                overflow: hidden !important;
            }
        </style>
        <title>CS410 Intro</title>
    </head>
    <body>

        <audio id = "music">
            <source src="Cinematic.wav">
        </audio>

        <audio id = "speech">
            <source src="speech.m4a">
        </audio>

        <script src="three.min.js"></script>
        <script src="three.js-master/examples/js/controls/TrackballControls.js"></script>
        <script>



        var scene, camera, renderer, rain, starGeometry, angle;
        angle = 0;
        fov = 60;
        ratio = window.innerWidth / window.innerHeight;
        zNear = 1;
        zFar = 1000;

        clicked = false;

        
        window.onclick = function() {

            if (clicked) {
                return;
            }

            clicked = true;

            init();

        }

        function init() {
            loadMusic();

            sceneSetup();

            // THIS
            var floorTexture = new THREE.TextureLoader().load( 'this.png' );
	        var floorGeometry = new THREE.PlaneBufferGeometry( 100, 100 );
	        var floorMaterial = new THREE.MeshBasicMaterial( { color: 0x000fff,
	        												   map: floorTexture,
	                                                           // side: THREE.DoubleSide
	                                                          } );
	        floor = new THREE.Mesh( floorGeometry, floorMaterial );
	        floor.position.set(0, 0, 120);
	        scene.add( floor );

	        // IS
	        var isTexture = new THREE.TextureLoader().load( 'is.png' );
	        var isGeometry = new THREE.PlaneBufferGeometry( 100, 100 );
	        var isMaterial = new THREE.MeshBasicMaterial( { color: 0x000fff,
	        												   map: isTexture
	                                                          } );
	        is = new THREE.Mesh( isGeometry, isMaterial );
	        is.position.set(0, 0, 50);
	        scene.add( is );


	        // CS410!
	        var csTexture = new THREE.TextureLoader().load( 'cs410!.png' );
	        var csGeometry = new THREE.PlaneBufferGeometry( 100, 100 );
	        var csMaterial = new THREE.MeshBasicMaterial( { color: 0x000fff,
	        												   map: csTexture
	                                                          } );
	        cs = new THREE.Mesh( csGeometry, csMaterial );
	        cs.position.set(0, 0, 10);
	        scene.add( cs );

	        // REAL SKILLS
			var skillsTexture = new THREE.TextureLoader().load( 'realskills.png' );
	        var skillsGeometry = new THREE.PlaneBufferGeometry( 100, 100 );
	        var skillsMaterial = new THREE.MeshBasicMaterial( { color: 0xFFA500,
	        												   map: skillsTexture
	                                                          } );
	        skills = new THREE.Mesh( skillsGeometry, skillsMaterial );
	        skills.position.set(0, 0, -30);
	        scene.add( skills );


	        // REAL PROJECTS
	        var projTexture = new THREE.TextureLoader().load( 'realprojects.png' );
	        var projGeometry = new THREE.PlaneBufferGeometry( 100, 100 );
	        var projMaterial = new THREE.MeshBasicMaterial( { color: 0xD3191C,
	        												   map: projTexture
	                                                          } );
	        proj = new THREE.Mesh( projGeometry, projMaterial );
	        proj.position.set(0, 0, -80);
	        scene.add( proj );

	        // $$
	        var moneyTexture = new THREE.TextureLoader().load( 'money.png' );
	        var moneyGeometry = new THREE.PlaneBufferGeometry( 100, 100 );
	        var moneyMaterial = new THREE.MeshBasicMaterial( { color: 0xFFD700,
	        												   map: moneyTexture
	                                                          } );
	        money = new THREE.Mesh( moneyGeometry, moneyMaterial );
	        money.position.set(0, 0, -110);
	        scene.add( money );

	        // REAL IMPACT
	        var impactTexture = new THREE.TextureLoader().load( 'realimpact.png' );
	        var impactGeometry = new THREE.PlaneBufferGeometry( 100, 100 );
	        var impactMaterial = new THREE.MeshBasicMaterial( { color: 0xCCFF00,
	        												   map: impactTexture
	                                                          } );
	        impact = new THREE.Mesh( impactGeometry, impactMaterial );
	        impact.position.set(0, 0, -160);
	        scene.add( impact );


            cameraSetup(fov, ratio, zNear, zFar);

            lightSetup();

            rendererSetup();

            createStars(70000);

            // trackballSetup(1, 100);

            setTimeout(function() {
        		var speech = document.getElementById('speech');
            	speech.autoplay = true;
            	speech.load();
        	}, 3000);

            animate();
        }

        function createStars(starCount) {
            starGeometry = new THREE.Geometry();

            for (var i = 0;i < starCount; i++) {
                star = new THREE.Vector3(
                Math.random() * 400 -200,
                Math.random() * 500 - 250,
                Math.random() * 400 - 200
                );
                starGeometry.vertices.push(star);
            }

            starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                transparent: true
            });

            stars = new THREE.Points(starGeometry, starMaterial);

            scene.add(stars);
        }

        function loadMusic() {
            var music = document.getElementById('music');
            music.autoplay = true;
            music.volume = 0.07;
            music.load();
        }

        function sceneSetup() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x010101, 0.002);
        }

        function cameraSetup(fov, ratio, zNear, zFar) {
            camera = new THREE.PerspectiveCamera(fov, ratio, zNear, zFar);
            camera.position.set(0, 0, 200);
        }

        function lightSetup() {
            ambient = new THREE.AmbientLight(0xffffff);
            scene.add(ambient);

            directionalLight = new THREE.DirectionalLight(0xffeedd);
            directionalLight.position.set(0,0,1);
            scene.add(directionalLight);
        }

        function rendererSetup() {
            renderer = new THREE.WebGLRenderer();
            renderer.setClearColor(scene.fog.color);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
        }

        function trackballSetup(minDist, maxDist) {
            // Trackball controls and settings
            controls = new THREE.TrackballControls(camera, renderer.domElement);
            /* Keep trackball within starGeometry box with these settings */
            // controls.minDistance = minDist;
            // controls.maxDistance = maxDist;
            controls.noPan = true;
        }

        /*
            Info: Remove an object from the scene
                  given an object name
        */
        function removeObject(object) {
            scene.remove(object);
            object.geometry.dispose();
            object.material.dispose();
            object = undefined;
        }

        function animate() {
        	setTimeout(function(){
        		timeflag = true;
           		removeObject(floor);
            	removeObject(is);
            	removeObject(cs);
            	removeObject(skills);
            	removeObject(proj);
            	removeObject(money);
            	removeObject(impact);

            	camera.position.set(0, 0, 200);

       		}, 31000);

        	/* Particle velocity & rotation */
        	stars.rotation.y +=0.00002;
            starGeometry.vertices.forEach(p => {
                p.velocity -= 0.001;
                p.y -= 0.02;
                if (p.y < -200) {
                    p.y = 200;
                    p.velocity = 0;
                }
            });
            camera.position.z -= 0.2;
            starGeometry.verticesNeedUpdate = true;
            // controls.update();
            money.rotateY(Math.PI/6);
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        </script>
    </body>
</html>